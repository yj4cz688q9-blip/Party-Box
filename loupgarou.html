<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loup Garou</title>
    <link rel="icon" type="image/png" href="F1CE1FF7-8FC2-440D-8100-49C689144B20.png">
    <link rel="apple-touch-icon" href="F1CE1FF7-8FC2-440D-8100-49C689144B20.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #0d0d0d; color: white; font-family: Arial, sans-serif; text-align: center; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .screen { display: none; flex-direction: column; align-items: center; justify-content: center; width: 100%; min-height: 100vh; padding: 20px; }
        .screen.active { display: flex; }
        h1 { font-size: 42px; color: #a78bfa; margin-bottom: 10px; }
        h2 { font-size: 26px; color: #a78bfa; margin-bottom: 20px; }
        .subtitle { font-size: 16px; color: #888; margin-bottom: 40px; }
        .start-btn { background-color: #a78bfa; color: #0d0d0d; border: none; border-radius: 20px; padding: 18px 40px; font-size: 20px; font-weight: bold; cursor: pointer; margin-top: 10px; width: 100%; max-width: 340px; }
        .back-btn { background: none; border: none; color: #888; font-size: 16px; margin-top: 20px; cursor: pointer; }
        .config-box { background-color: #1a1a1a; border-radius: 20px; padding: 20px; width: 100%; max-width: 340px; margin-bottom: 15px; }
        .config-label { font-size: 15px; color: #aaa; margin-bottom: 12px; text-align: left; }
        .section-title { font-size: 13px; color: #a78bfa; text-transform: uppercase; letter-spacing: 1px; text-align: left; width: 100%; max-width: 340px; margin: 15px 0 5px; }
        .chance-slider { width: 100%; accent-color: #a78bfa; margin: 10px 0; }
        .chance-value { font-size: 28px; font-weight: bold; color: #a78bfa; }
        .player-input { background-color: #1a1a1a; border: 2px solid #333; border-radius: 12px; padding: 12px 16px; color: white; font-size: 16px; width: 100%; max-width: 340px; margin: 6px 0; }
        .player-input:focus { border-color: #a78bfa; outline: none; }
        .role-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #222; }
        .role-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .role-info { display: flex; align-items: center; gap: 10px; text-align: left; flex: 1; }
        .role-emoji { font-size: 24px; min-width: 30px; }
        .role-nom { font-size: 14px; font-weight: bold; }
        .role-desc-config { font-size: 11px; color: #888; margin-top: 2px; line-height: 1.3; }
        .role-counter { display: flex; align-items: center; gap: 8px; }
        .role-btn { background-color: #a78bfa; color: #0d0d0d; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 16px; cursor: pointer; font-weight: bold; }
        .role-count { font-size: 18px; font-weight: bold; min-width: 20px; }
        .total-info { font-size: 14px; color: #888; margin-bottom: 15px; }
        .total-info span { color: #a78bfa; font-weight: bold; }
        .equipe-badge { display: inline-block; padding: 3px 8px; border-radius: 10px; font-size: 11px; font-weight: bold; margin-bottom: 4px; }
        .badge-loup { background-color: #3d0000; color: #ff5555; }
        .badge-village { background-color: #003d2e; color: #00e5cc; }
        .badge-solitaire { background-color: #3d3000; color: #ffcc00; }

        /* CARTE R√îLE */
        .carte-role { background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #a78bfa; border-radius: 24px; padding: 30px 25px; width: 100%; max-width: 320px; margin-bottom: 20px; }
        .carte-role-emoji { font-size: 70px; margin-bottom: 12px; }
        .carte-role-nom { font-size: 26px; font-weight: bold; color: #a78bfa; margin-bottom: 8px; }
        .carte-role-equipe { font-size: 13px; margin-bottom: 12px; }
        .carte-role-desc { font-size: 14px; color: #ccc; line-height: 1.6; margin-bottom: 12px; }
        .carte-role-pouvoir { background-color: #0d0d2e; border-radius: 12px; padding: 12px; font-size: 13px; color: #a78bfa; line-height: 1.5; }

        /* NUIT */
        .nuit-bg { background: linear-gradient(180deg, #0d0d1a, #0d0d0d); }
        .phase-emoji { font-size: 70px; margin-bottom: 15px; }
        .narration { font-size: 15px; color: #ccc; line-height: 1.7; margin-bottom: 25px; max-width: 320px; font-style: italic; }
        .action-box { background-color: #1a1a1a; border-radius: 20px; padding: 20px; width: 100%; max-width: 340px; margin-bottom: 20px; }
        .joueurs-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 10px; }
        .joueur-btn { background-color: #2a2a2a; border: 2px solid #444; border-radius: 12px; padding: 8px 14px; color: white; font-size: 14px; cursor: pointer; }
        .joueur-btn.selected { border-color: #a78bfa; background-color: #2a1a4a; color: #a78bfa; font-weight: bold; }
        .joueur-btn.mort { opacity: 0.4; text-decoration: line-through; cursor: not-allowed; }
        .joueur-btn.empoisonne { border-color: #ff3b3b; background-color: #2a0000; }
        .jour-bg { background: linear-gradient(180deg, #1a1000, #0d0d0d); }
        .mort-annonce { background-color: #2a0000; border: 2px solid #ff3b3b; border-radius: 20px; padding: 20px; width: 100%; max-width: 340px; margin-bottom: 20px; font-size: 16px; line-height: 1.6; }
        .vote-joueur { background-color: #1a1a1a; border: 2px solid #333; border-radius: 14px; padding: 15px; width: 100%; max-width: 340px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .vote-joueur.selected { border-color: #ff3b3b; }
        .equipe-gagnante { font-size: 48px; margin-bottom: 10px; }
        .score-final-box { background-color: #1a1a1a; border-radius: 16px; padding: 12px 15px; width: 100%; max-width: 340px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .countdown-big { font-size: 72px; font-weight: bold; color: #a78bfa; margin: 20px 0; }
        .sommeil-texte { font-size: 18px; color: #ccc; font-style: italic; margin-bottom: 10px; max-width: 300px; }

        /* CHASSEUR */
        .chasseur-box { background-color: #2a1a00; border: 2px solid #ff9500; border-radius: 20px; padding: 20px; width: 100%; max-width: 340px; margin-bottom: 20px; }

        /* JOUEUR DE FL√õTE */
        .flute-box { background-color: #1a2a1a; border: 2px solid #00cc66; border-radius: 20px; padding: 20px; width: 100%; max-width: 340px; margin-bottom: 20px; }

        .section-config { font-size: 14px; color: #a78bfa; font-weight: bold; text-align: left; margin: 15px 0 8px; padding-left: 5px; border-left: 3px solid #a78bfa; }
    </style>
</head>
<body>

    <!-- ACCUEIL -->
    <div class="screen active" id="screen-home">
        <h1>üê∫ Loup Garou</h1>
        <p class="subtitle">Le village contre les loups...</p>
    <button class="start-btn" onclick="nbJoueurs=8; showScreen('screen-config'); setTimeout(suggererRoles, 100);">üåô Nouvelle partie</button>
        <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Retour √† Party Box</button>
    </div>

    <!-- CONFIG -->
    <div class="screen" id="screen-config">
        <h2>‚öôÔ∏è Configuration</h2>

        <p class="section-title">üë• Joueurs</p>
        <div class="config-box">
            <p class="config-label">Nombre de joueurs</p>
            <input type="range" class="chance-slider" min="5" max="24" value="8" id="nb-joueurs-slider" oninput="updateNbJoueurs(this.value)">
            <div class="chance-value" id="nb-joueurs-value">8 joueurs</div>
        </div>

        <p class="section-title">üé≠ R√¥les</p>
        <div class="config-box">
            <p class="config-label">Composition (modifiable)</p>

            <p class="section-config">üê∫ √âquipe des Loups</p>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üê∫</span><div><div class="role-nom">Loup Garou</div><div class="role-desc-config">D√©vore un villageois chaque nuit</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('loup',-1)">‚àí</button><span class="role-count" id="count-loup">2</span><button class="role-btn" onclick="changeRole('loup',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üåô</span><div><div class="role-nom">Grand M√©chant Loup</div><div class="role-desc-config">Loup qui d√©vore une 2√®me victime si tous les loups sp√©ciaux sont morts</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('grandloup',-1)">‚àí</button><span class="role-count" id="count-grandloup">0</span><button class="role-btn" onclick="changeRole('grandloup',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üêë</span><div><div class="role-nom">Enfant Loup</div><div class="role-desc-config">Villageois li√© √† un p√®re. Devient loup si son p√®re meurt</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('enfantloup',-1)">‚àí</button><span class="role-count" id="count-enfantloup">0</span><button class="role-btn" onclick="changeRole('enfantloup',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üê∫</span><div><div class="role-nom">Loup Blanc</div><div class="role-desc-config">Loup solitaire qui veut gagner seul. Peut √©liminer un loup chaque 2√®me nuit</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('loupblanc',-1)">‚àí</button><span class="role-count" id="count-loupblanc">0</span><button class="role-btn" onclick="changeRole('loupblanc',1)">+</button></div>
            </div>

            <p class="section-config">üßë‚Äçüåæ √âquipe du Village</p>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üßë‚Äçüåæ</span><div><div class="role-nom">Villageois</div><div class="role-desc-config">Pas de pouvoir, vote pour √©liminer les loups</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('villageois',-1)">‚àí</button><span class="role-count" id="count-villageois">2</span><button class="role-btn" onclick="changeRole('villageois',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üëÅÔ∏è</span><div><div class="role-nom">Voyante</div><div class="role-desc-config">Voit le r√¥le d'un joueur chaque nuit</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('voyante',-1)">‚àí</button><span class="role-count" id="count-voyante">1</span><button class="role-btn" onclick="changeRole('voyante',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üßô</span><div><div class="role-nom">Sorci√®re</div><div class="role-desc-config">Une potion de vie, une de mort</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('sorciere',-1)">‚àí</button><span class="role-count" id="count-sorciere">1</span><button class="role-btn" onclick="changeRole('sorciere',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üíò</span><div><div class="role-nom">Cupidon</div><div class="role-desc-config">D√©signe 2 amoureux au d√©but</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('cupidon',-1)">‚àí</button><span class="role-count" id="count-cupidon">1</span><button class="role-btn" onclick="changeRole('cupidon',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üëß</span><div><div class="role-nom">Petite Fille</div><div class="role-desc-config">Peut espionner les loups la nuit</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('petitefille',-1)">‚àí</button><span class="role-count" id="count-petitefille">1</span><button class="role-btn" onclick="changeRole('petitefille',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üèπ</span><div><div class="role-nom">Chasseur</div><div class="role-desc-config">Quand il meurt, il tire sur un joueur de son choix</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('chasseur',-1)">‚àí</button><span class="role-count" id="count-chasseur">0</span><button class="role-btn" onclick="changeRole('chasseur',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üë¥</span><div><div class="role-nom">Ancien</div><div class="role-desc-config">Survit √† la premi√®re attaque des loups</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('ancien',-1)">‚àí</button><span class="role-count" id="count-ancien">0</span><button class="role-btn" onclick="changeRole('ancien',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üé≠</span><div><div class="role-nom">Bouc √âmissaire</div><div class="role-desc-config">√âlimin√© en cas d'√©galit√© au vote. Choisit alors qui ne vote pas la prochaine fois</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('bouc',-1)">‚àí</button><span class="role-count" id="count-bouc">0</span><button class="role-btn" onclick="changeRole('bouc',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üêª</span><div><div class="role-nom">Ours de Thiercelieux</div><div class="role-desc-config">Le meneur grogne au d√©but de chaque jour si un loup est adjacent √† l'Ours</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('ours',-1)">‚àí</button><span class="role-count" id="count-ours">0</span><button class="role-btn" onclick="changeRole('ours',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">ü¶ä</span><div><div class="role-nom">Renard</div><div class="role-desc-config">Peut flairer un groupe de 3 joueurs pour savoir si l'un est loup</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('renard',-1)">‚àí</button><span class="role-count" id="count-renard">0</span><button class="role-btn" onclick="changeRole('renard',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üíã</span><div><div class="role-nom">S√©ductrice</div><div class="role-desc-config">Chaque nuit, rend un joueur muet le lendemain (ne peut pas voter ni parler)</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('seductrice',-1)">‚àí</button><span class="role-count" id="count-seductrice">0</span><button class="role-btn" onclick="changeRole('seductrice',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üé∫</span><div><div class="role-nom">Joueur de Fl√ªte</div><div class="role-desc-config">Ensorcelle des joueurs chaque nuit. Gagne si tous les vivants sont ensorcel√©s</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('flute',-1)">‚àí</button><span class="role-count" id="count-flute">0</span><button class="role-btn" onclick="changeRole('flute',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üë®‚Äç‚öñÔ∏è</span><div><div class="role-nom">Juge B√®gue</div><div class="role-desc-config">Peut d√©clencher un 2√®me vote une fois dans la partie</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('juge',-1)">‚àí</button><span class="role-count" id="count-juge">0</span><button class="role-btn" onclick="changeRole('juge',1)">+</button></div>
            </div>
            <div class="role-row">
                <div class="role-info"><span class="role-emoji">üßí</span><div><div class="role-nom">Enfant Sauvage</div><div class="role-desc-config">Choisit un mod√®le au d√©but. Devient loup si son mod√®le meurt</div></div></div>
                <div class="role-counter"><button class="role-btn" onclick="changeRole('enfantsauvage',-1)">‚àí</button><span class="role-count" id="count-enfantsauvage">0</span><button class="role-btn" onclick="changeRole('enfantsauvage',1)">+</button></div>
            </div>
        </div>

        <p class="total-info">Total r√¥les : <span id="total-roles">8</span> / <span id="total-joueurs">8</span></p>
        <button class="start-btn" onclick="showNomJoueurs()">Suivant ‚û°Ô∏è</button>
        <button class="back-btn" onclick="showScreen('screen-home')">‚Üê Retour</button>
    </div>

    <!-- NOMS JOUEURS -->
    <div class="screen" id="screen-noms">
        <h2>‚úèÔ∏è Noms des joueurs</h2>
        <div id="noms-inputs"></div>
        <button class="start-btn" onclick="distribuerRoles()" style="margin-top:20px">Distribuer les r√¥les üé≠</button>
        <button class="back-btn" onclick="showScreen('screen-config')">‚Üê Retour</button>
    </div>

    <!-- PASSAGE R√îLE -->
    <div class="screen" id="screen-role">
        <div class="countdown-big" id="role-countdown">5</div>
        <p style="color:#555; font-size:14px">Attendez que l'√©cran se d√©bloque...</p>
    </div>

    <!-- VOIR R√îLE -->
    <div class="screen" id="screen-voir-role">
        <p style="color:#888; font-size:14px; margin-bottom:5px" id="role-passage">üëã Joueur, regarde ton r√¥le !</p>
        <p style="color:#555; font-size:12px; margin-bottom:15px">‚ö†Ô∏è Ne montrez pas votre r√¥le aux autres !</p>
        <div class="carte-role">
            <div class="carte-role-emoji" id="role-emoji"></div>
            <div class="carte-role-nom" id="role-nom"></div>
            <div class="carte-role-equipe" id="role-equipe"></div>
            <div class="carte-role-desc" id="role-desc"></div>
            <div class="carte-role-pouvoir" id="role-pouvoir"></div>
        </div>
        <button class="start-btn" onclick="roleVuSuivant()">‚úÖ J'ai vu mon r√¥le</button>
    </div>

    <!-- SOMMEIL -->
    <div class="screen nuit-bg" id="screen-sommeil">
        <div class="phase-emoji">üò¥</div>
        <p class="sommeil-texte" id="sommeil-texte"></p>
        <div class="countdown-big" id="sommeil-countdown">5</div>
    </div>

    <!-- NUIT INTRO -->
    <div class="screen nuit-bg" id="screen-nuit-intro">
        <div class="phase-emoji">üåô</div>
        <h2>La nuit tombe...</h2>
        <p class="narration" id="nuit-narration"></p>
        <button class="start-btn" onclick="commencerNuit()" style="background-color:#4a3a8a">Commencer la nuit üåô</button>
    </div>

    <!-- PHASE NUIT -->
    <div class="screen nuit-bg" id="screen-phase">
        <div class="phase-emoji" id="phase-emoji"></div>
        <h2 id="phase-titre"></h2>
        <p class="narration" id="phase-narration"></p>
        <div class="action-box" id="phase-action"></div>
        <button class="start-btn" id="phase-btn" style="background-color:#4a3a8a">Confirmer ‚úÖ</button>
    </div>

    <!-- CHASSEUR TIRE -->
    <div class="screen" id="screen-chasseur">
        <div class="chasseur-box">
            <div style="font-size:50px;margin-bottom:10px">üèπ</div>
            <p style="font-size:18px;font-weight:bold;color:#ff9500;margin-bottom:10px" id="chasseur-nom"></p>
            <p style="color:#aaa;font-size:14px">Le Chasseur est mort ! Avant de partir, il tire sur quelqu'un...</p>
        </div>
        <div class="joueurs-grid" id="chasseur-cibles"></div>
        <button class="start-btn" onclick="confirmerTirChasseur()" style="background-color:#ff9500;margin-top:20px">üèπ Tirer !</button>
    </div>

    <!-- ENFANT SAUVAGE CHOISIT MOD√àLE -->
    <div class="screen" id="screen-enfantsauvage">
        <div class="phase-emoji">üßí</div>
        <h2>L'Enfant Sauvage</h2>
        <p class="narration">Choisissez votre mod√®le. Si cette personne meurt, vous deviendrez un Loup Garou !</p>
        <div class="joueurs-grid" id="enfantsauvage-cibles"></div>
        <button class="start-btn" onclick="confirmerModele()" style="background-color:#4a3a8a;margin-top:20px">Confirmer ‚úÖ</button>
    </div>

    <!-- ENFANT LOUP CHOISIT P√àRE -->
    <div class="screen" id="screen-enfantloup">
        <div class="phase-emoji">üêë</div>
        <h2>L'Enfant Loup</h2>
        <p class="narration">Choisissez votre p√®re parmi les villageois. Si votre p√®re meurt, vous rejoindrez les loups !</p>
        <div class="joueurs-grid" id="enfantloup-cibles"></div>
        <button class="start-btn" onclick="confirmerPere()" style="background-color:#4a3a8a;margin-top:20px">Confirmer ‚úÖ</button>
    </div>

    <!-- JOUR -->
    <div class="screen jour-bg" id="screen-jour">
        <div class="phase-emoji">‚òÄÔ∏è</div>
        <h2>Le jour se l√®ve</h2>
        <div id="mort-annonce-box"></div>
        <div id="ours-annonce" style="display:none;background-color:#2a1a00;border:2px solid #ff9500;border-radius:16px;padding:15px;width:100%;max-width:340px;margin-bottom:15px;font-size:16px">üêª GRRR ! L'Ours grogne ‚Äî un loup est assis √† c√¥t√© de lui !</div>
        <p class="narration" id="jour-narration">Les survivants se rassemblent sur la place du village...</p>
        <button class="start-btn" onclick="commencerVote()">üó≥Ô∏è Voter</button>
    </div>

    <!-- VOTE -->
    <div class="screen" id="screen-vote">
        <h2>üó≥Ô∏è Vote du village</h2>
        <p style="color:#888; margin-bottom:20px" id="vote-subtitle">Qui voulez-vous √©liminer ?</p>
        <div id="vote-liste"></div>
        <button class="start-btn" onclick="confirmerVote()" style="margin-top:10px; background-color:#ff3b3b">√âliminer üíÄ</button>
        <button class="back-btn" onclick="passerVote()">‚è≠Ô∏è Pas de vote</button>
    </div>

    <!-- FIN -->
    <div class="screen" id="screen-fin">
        <div class="equipe-gagnante" id="fin-emoji"></div>
        <h2 id="fin-titre"></h2>
        <p style="color:#888; margin-bottom:20px" id="fin-desc"></p>
        <div id="fin-roles" style="width:100%;max-width:340px"></div>
        <button class="start-btn" onclick="showScreen('screen-home')" style="margin-top:30px">üè† Accueil</button>
    </div>

    <script>
        let nbJoueurs = 8;
        window.onload = function() { suggererRoles(); };
        let rolesConfig = { loup:2, grandloup:0, enfantloup:0, loupblanc:0, villageois:2, voyante:1, sorciere:1, cupidon:1, petitefille:1, chasseur:0, ancien:0, bouc:0, ours:0, renard:0, seductrice:0, flute:0, juge:0, enfantsauvage:0 };
        let joueurs=[], indexDistrib=0, amoureux=[], amoureuxTemp=[];
        let sorcierePotionVie=true, sorcierePotionMort=true;
        let sauveParSorciere=false, empoisonneParSorciere=null;
        let victimeNuit=null, phaseIndex=0, phases=[], voteSelectionne=-1, numNuit=0;
        let ancienPremierAttaque=true, modeleEnfantSauvage=null, pereEnfantLoup=null;
        let chasseurCible=null, jugeUtilise=false, muetDemain=null, muetAujourdhui=null;
        let ensorcel√©s=[], loupBlancPeutTuer=false;

        const ROLES_INFO = {
            loup:         { emoji:'üê∫', nom:'Loup Garou',         equipe:'loup',     equipeLabel:'üê∫ √âquipe des Loups',
                desc:'Vous faites partie de la meute des loups garous. Votre but est d\'√©liminer tous les villageois.',
                pouvoir:'üí° Chaque nuit, vous vous r√©veillez avec les autres loups pour choisir ensemble une victime √† d√©vorer. Le jour, faites semblant d\'√™tre innocent pour ne pas √™tre √©limin√© par le village !' },
            grandloup:    { emoji:'üåô', nom:'Grand M√©chant Loup', equipe:'loup',     equipeLabel:'üê∫ √âquipe des Loups',
                desc:'Vous √™tes le plus puissant des loups garous. Vous vous r√©veillez avec la meute chaque nuit.',
                pouvoir:'üí° Tant qu\'il reste des loups sp√©ciaux (Loup Blanc, Enfant Loup) en vie, vous jouez normalement. Quand ils sont tous morts, vous pouvez d√©vorer une 2√®me victime suppl√©mentaire chaque nuit !' },
            loupblanc:    { emoji:'üê∫', nom:'Loup Blanc',         equipe:'solitaire', equipeLabel:'üåü Solitaire',
                desc:'Vous √™tes un loup solitaire. Vous vous r√©veillez avec les autres loups mais vous voulez gagner SEUL.',
                pouvoir:'üí° Vous rejoignez les loups la nuit mais les 2√®me nuits (nuit 2, 4, 6...) vous pouvez √©liminer un loup de votre choix. Vous gagnez si vous √™tes le DERNIER survivant !' },
            enfantloup:   { emoji:'üêë', nom:'Enfant Loup',        equipe:'variable', equipeLabel:'‚ùì Variable',
                desc:'Vous √™tes un villageois, mais vous avez un lien profond avec votre p√®re adoptif.',
                pouvoir:'üí° Au d√©but de la partie, vous choisissez un joueur comme "p√®re". Tant qu\'il est vivant, vous jouez pour le village. Si votre p√®re meurt, vous rejoignez les loups garous et vous r√©veillez avec eux !' },
            villageois:   { emoji:'üßë‚Äçüåæ', nom:'Villageois',        equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous √™tes un simple villageois. Vous n\'avez aucun pouvoir sp√©cial, mais votre instinct et votre capacit√© √† convaincre les autres sont vos meilleures armes.',
                pouvoir:'üí° Participez activement aux d√©bats du jour ! Observez le comportement des autres joueurs, posez des questions, et votez pour √©liminer ceux qui vous semblent suspects.' },
            voyante:      { emoji:'üëÅÔ∏è', nom:'Voyante',            equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous avez un don de clairvoyance. Chaque nuit, vous pouvez percer les secrets d\'un joueur.',
                pouvoir:'üí° Chaque nuit, choisissez un joueur et l\'app vous r√©v√©lera son r√¥le exact. Partagez subtilement vos d√©couvertes le jour sans vous faire rep√©rer par les loups !' },
            sorciere:     { emoji:'üßô', nom:'Sorci√®re',           equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous √™tes une puissante sorci√®re qui poss√®de deux potions magiques tr√®s pr√©cieuses.',
                pouvoir:'üí° Potion de VIE üíö : utilisable une seule fois pour sauver la victime des loups cette nuit. Potion de MORT ‚ò†Ô∏è : utilisable une seule fois pour empoisonner n\'importe quel joueur. Utilisez-les avec sagesse !' },
            cupidon:      { emoji:'üíò', nom:'Cupidon',            equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous √™tes le dieu de l\'amour. La premi√®re nuit, vous unissez deux √¢mes pour toujours.',
                pouvoir:'üí° La premi√®re nuit, d√©signez 2 joueurs qui deviennent amoureux. Les amoureux connaissent leur partenaire. Si l\'un meurt, l\'autre meurt de chagrin. Si les amoureux sont un loup et un villageois, ils ont une 3√®me condition de victoire : √™tre les 2 derniers survivants !' },
            petitefille:  { emoji:'üëß', nom:'Petite Fille',       equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous √™tes curieuse et courageuse. Pendant que tout le monde dort, vous risquez votre vie pour espionner.',
                pouvoir:'üí° Pendant la nuit des loups, vous pouvez "entrouvrir les yeux" pour voir les loups. L\'app vous montrera leurs noms ! Mais attention : si les loups vous rep√®rent, vous serez √©limin√©e √† la place de leur victime !' },
            chasseur:     { emoji:'üèπ', nom:'Chasseur',           equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous √™tes un chasseur expert. M√™me dans la mort, vous ne partez pas sans riposter.',
                pouvoir:'üí° Quand vous mourez (attaque des loups OU vote du village), vous tirez imm√©diatement sur un joueur de votre choix qui mourra avec vous. Choisissez bien votre cible !' },
            ancien:       { emoji:'üë¥', nom:'Ancien',             equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous √™tes le sage du village. Votre longue exp√©rience vous a rendu plus r√©sistant.',
                pouvoir:'üí° Vous survivez √† la PREMI√àRE attaque des loups (vous restez en vie cette nuit-l√†). Mais si le village vous √©limine par vote, tous les villageois sp√©ciaux perdent leurs pouvoirs !' },
            bouc:         { emoji:'üé≠', nom:'Bouc √âmissaire',     equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous √™tes toujours celui qu\'on accuse en premier. Mais m√™me dans la mort, vous avez un dernier mot.',
                pouvoir:'üí° En cas d\'√©galit√© lors d\'un vote, c\'est vous qui √™tes √©limin√©. En compensation, vous choisissez UN joueur qui n\'aura pas le droit de voter lors du prochain vote du jour !' },
            ours:         { emoji:'üêª', nom:'Ours de Thiercelieux', equipe:'village', equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous √™tes un ours domestique qui sent le danger. Votre instinct d√©tecte les loups qui vous entourent.',
                pouvoir:'üí° Au d√©but de chaque journ√©e, si l\'un de vos voisins imm√©diats (assis √† c√¥t√© de vous en cercle) est un loup, le meneur de jeu dit "GRRR" pour avertir le village !' },
            renard:       { emoji:'ü¶ä', nom:'Renard',             equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous √™tes rus√© et votre flair est l√©gendaire. Vous pouvez d√©tecter la pr√©sence des loups.',
                pouvoir:'üí° Chaque nuit, choisissez un groupe de 3 joueurs. L\'app vous dira si au moins l\'un d\'eux est un loup. Si aucun n\'est loup, vous perdez votre pouvoir pour le reste de la partie !' },
            seductrice:   { emoji:'üíã', nom:'S√©ductrice',         equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous avez un charme irr√©sistible. D\'un regard, vous pouvez r√©duire quelqu\'un au silence.',
                pouvoir:'üí° Chaque nuit, choisissez un joueur qui sera "ensorcel√©" par votre charme. Le lendemain, ce joueur ne pourra pas parler ni voter lors du d√©bat du jour !' },
            flute:        { emoji:'üé∫', nom:'Joueur de Fl√ªte',    equipe:'solitaire', equipeLabel:'üåü Solitaire',
                desc:'Vous jouez seul contre tous. Votre musique enivrante soumet les esprits √† votre volont√©.',
                pouvoir:'üí° Chaque nuit, ensorcelez 2 joueurs avec votre fl√ªte. Vous gagnez si TOUS les joueurs encore en vie sont ensorcel√©s par vous. Ni le village ni les loups ‚Äî vous seul gagnez !' },
            juge:         { emoji:'üë®‚Äç‚öñÔ∏è', nom:'Juge B√®gue',        equipe:'village',  equipeLabel:'üßë‚Äçüåæ Village',
                desc:'Vous √™tes le juge du village. Vous avez le pouvoir de provoquer un second proc√®s.',
                pouvoir:'üí° Une seule fois dans la partie, vous pouvez faire signe au meneur pour d√©clencher un DEUXI√àME vote imm√©diatement apr√®s le premier. Cette capacit√© est secr√®te ‚Äî faites un signe discret !' },
            enfantsauvage:{ emoji:'üßí', nom:'Enfant Sauvage',     equipe:'variable', equipeLabel:'‚ùì Variable',
                desc:'Vous avez grandi seul dans la for√™t. Vous avez besoin d\'un mod√®le pour rester du c√¥t√© des humains.',
                pouvoir:'üí° Au d√©but de la partie, choisissez un joueur comme "mod√®le". Tant qu\'il est vivant, vous jouez pour le village. Si votre mod√®le meurt, vous devenez un Loup Garou et rejoignez la meute !' },
        };

        function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}



        function parler(texte) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(texte);
                u.lang='fr-FR'; u.rate=0.85; u.pitch=0.8;
                window.speechSynthesis.speak(u);
            }
        }

        function afficherSommeil(texte, callback) {
            showScreen('screen-sommeil');
            document.getElementById('sommeil-texte').textContent = texte;
            parler(texte);
            let count = 5;
            document.getElementById('sommeil-countdown').textContent = count;
            const interval = setInterval(() => {
                count--;
                document.getElementById('sommeil-countdown').textContent = count;
                if (count <= 0) { clearInterval(interval); callback(); }
            }, 1000);
        }

        function updateNbJoueurs(val) {
            nbJoueurs = parseInt(val);
            document.getElementById('nb-joueurs-value').textContent = val + ' joueurs';
            suggererRoles();
        }

function allerConfig() {
    showScreen('screen-config');
    setTimeout(function() { suggererRoles(); }, 50);
}

        function suggererRoles() {
            const n = nbJoueurs;
            let loups = Math.max(1, Math.floor(n / 4));
            rolesConfig = { loup:loups, grandloup:0, enfantloup:0, loupblanc:0, villageois:Math.max(0,n-loups-4), voyante:1, sorciere:1, cupidon:1, petitefille:n>=8?1:0, chasseur:n>=10?1:0, ancien:n>=12?1:0, bouc:0, ours:0, renard:0, seductrice:0, flute:0, juge:0, enfantsauvage:0 };
            // Ajuster villageois
            let total = Object.values(rolesConfig).reduce((a,b)=>a+b,0);
            rolesConfig.villageois = Math.max(0, rolesConfig.villageois + (n - total));
            try { Object.keys(rolesConfig).forEach(r => { const el = document.getElementById('count-'+r); if(el) el.textContent = rolesConfig[r]; }); updateTotal(); } catch(e) {}
            updateTotal();
        }

        function changeRole(role, delta) {
            rolesConfig[role] = Math.max(0, rolesConfig[role] + delta);
            document.getElementById('count-'+role).textContent = rolesConfig[role];
            updateTotal();
        }

        function updateTotal() {
            const total = Object.values(rolesConfig).reduce((a,b)=>a+b,0);
            document.getElementById('total-roles').textContent = total;
            document.getElementById('total-joueurs').textContent = nbJoueurs;
            document.getElementById('total-roles').style.color = total===nbJoueurs ? '#00e5cc' : '#ff3b3b';
        }

        function showNomJoueurs() {
            const total = Object.values(rolesConfig).reduce((a,b)=>a+b,0);
            if (total !== nbJoueurs) { alert('Le nombre de r√¥les ('+total+') doit √™tre √©gal au nombre de joueurs ('+nbJoueurs+') !'); return; }
            const c = document.getElementById('noms-inputs');
            c.innerHTML = '';
            for (let i=1;i<=nbJoueurs;i++) {
                const inp = document.createElement('input');
                inp.className='player-input'; inp.placeholder='üßë Joueur '+i; inp.id='nom-'+i;
                c.appendChild(inp);
            }
            showScreen('screen-noms');
        }

        function distribuerRoles() {
            let liste = [];
            Object.entries(rolesConfig).forEach(([role,count]) => { for(let i=0;i<count;i++) liste.push(role); });
            for(let i=liste.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [liste[i],liste[j]]=[liste[j],liste[i]];
}

            joueurs = [];
            for(let i=1;i<=nbJoueurs;i++) {
                const nom = document.getElementById('nom-'+i).value.trim() || 'Joueur '+i;
                joueurs.push({ nom, role:liste[i-1], vivant:true, amoureux:false, muet:false, ensorcele:false, ancienVie:true });
            }
            indexDistrib=0; afficherPassageRole();
        }

        function afficherPassageRole() {
            if (indexDistrib >= joueurs.length) { preparerDebut(); return; }
            showScreen('screen-role');
            let count=5;
            document.getElementById('role-countdown').textContent=count;
            const interval=setInterval(()=>{
                count--;
                document.getElementById('role-countdown').textContent=count;
                if(count<=0){
                    clearInterval(interval);
                    const j=joueurs[indexDistrib];
                    const info=ROLES_INFO[j.role];
                    document.getElementById('role-passage').textContent='üëã '+j.nom+', regarde ton r√¥le !';
                    document.getElementById('role-emoji').textContent=info.emoji;
                    document.getElementById('role-nom').textContent=info.nom;
                    document.getElementById('role-equipe').innerHTML='<span class="equipe-badge badge-'+(info.equipe==='loup'?'loup':info.equipe==='solitaire'?'solitaire':'village')+'">'+info.equipeLabel+'</span>';
                    document.getElementById('role-desc').textContent=info.desc;
                    document.getElementById('role-pouvoir').textContent=info.pouvoir;
                    showScreen('screen-voir-role');
                }
            },1000);
        }

        function roleVuSuivant() { indexDistrib++; afficherPassageRole(); }

        function preparerDebut() {
            amoureux=[]; sorcierePotionVie=true; sorcierePotionMort=true;
            victimeNuit=null; numNuit=1; ancienPremierAttaque=true;
            modeleEnfantSauvage=null; pereEnfantLoup=null; muetDemain=null; muetAujourdhui=null;
            ensorcel√©s=[]; loupBlancPeutTuer=false; jugeUtilise=false;

            // Phases de d√©but sp√©ciales
            const phasesDebut = [];
            if (joueurs.some(j=>j.role==='enfantsauvage')) phasesDebut.push('enfantsauvage_setup');
            if (joueurs.some(j=>j.role==='enfantloup')) phasesDebut.push('enfantloup_setup');

            if (phasesDebut.length > 0) {
                if (phasesDebut[0]==='enfantsauvage_setup') afficherEnfantSauvageSetup(phasesDebut);
                else if (phasesDebut[0]==='enfantloup_setup') afficherEnfantLoupSetup();
            } else {
                afficherNuitIntro();
            }
        }

        function afficherEnfantSauvageSetup(suite) {
            parler("L'Enfant Sauvage se r√©veille... Il choisit son mod√®le parmi les joueurs...");
            const grid = document.getElementById('enfantsauvage-cibles');
            grid.innerHTML='';
            joueurs.forEach((j,idx)=>{
                if(j.role==='enfantsauvage') return;
                const btn=document.createElement('button');
                btn.className='joueur-btn'; btn.textContent=j.nom;
                btn.onclick=()=>{ modeleEnfantSauvage=idx; document.querySelectorAll('#enfantsauvage-cibles .joueur-btn').forEach(b=>b.classList.remove('selected')); btn.classList.add('selected'); };
                grid.appendChild(btn);
            });
            showScreen('screen-enfantsauvage');
        }

        function confirmerModele() {
            if(modeleEnfantSauvage===null){alert('Choisissez un mod√®le !');return;}
            const suiteIdx = joueurs.some(j=>j.role==='enfantloup') ? 'enfantloup' : null;
            afficherSommeil("L'Enfant Sauvage peut se rendormir...", ()=>{
                if(suiteIdx) afficherEnfantLoupSetup();
                else afficherNuitIntro();
            });
        }

        function afficherEnfantLoupSetup() {
            parler("L'Enfant Loup se r√©veille... Il choisit son p√®re parmi les villageois...");
            const grid=document.getElementById('enfantloup-cibles');
            grid.innerHTML='';
            joueurs.forEach((j,idx)=>{
                if(j.role==='loup'||j.role==='grandloup'||j.role==='loupblanc'||j.role==='enfantloup') return;
                const btn=document.createElement('button');
                btn.className='joueur-btn'; btn.textContent=j.nom;
                btn.onclick=()=>{ pereEnfantLoup=idx; document.querySelectorAll('#enfantloup-cibles .joueur-btn').forEach(b=>b.classList.remove('selected')); btn.classList.add('selected'); };
                grid.appendChild(btn);
            });
            showScreen('screen-enfantloup');
        }

        function confirmerPere() {
            if(pereEnfantLoup===null){alert('Choisissez un p√®re !');return;}
            afficherSommeil("L'Enfant Loup peut se rendormir...", afficherNuitIntro);
        }

        function afficherNuitIntro() {
            muetAujourdhui = muetDemain; muetDemain = null;
            const narration = numNuit===1
                ? "Le soleil se couche sur le paisible village de Thiercelieux... Les habitants, √©puis√©s par leur journ√©e, ferment les yeux et sombrent dans le sommeil. Mais dans l'obscurit√©, des cr√©atures terrifiantes s'√©veillent..."
                : "Une nouvelle nuit s'√©tend sur le village meurtri... Les survivants s'endorment, la peur au ventre, sachant que les loups r√¥dent encore dans les t√©n√®bres...";
            document.getElementById('nuit-narration').textContent=narration;
            parler(narration);
            showScreen('screen-nuit-intro');
        }

        function commencerNuit() {
    victimeNuit=null; sauveParSorciere=false; empoisonneParSorciere=null;
    loupBlancPeutTuer = (numNuit%2===0);
    construirePhases(); phaseIndex=0;
    let count=5;
    document.getElementById('nuit-narration').textContent='La nuit commence dans '+count+'...';
    const btn=document.querySelector('#screen-nuit-intro .start-btn');
    btn.style.display='none';
    const interval=setInterval(()=>{
        count--;
        document.getElementById('nuit-narration').textContent=count>0?'La nuit commence dans '+count+'...':'üåô Bonne nuit...';
        if(count<=0){ clearInterval(interval); btn.style.display='block'; jouerPhase(); }
    },1000);
}


        function construirePhases() {
            phases=[];
            if(numNuit===1 && joueurs.some(j=>j.role==='cupidon'&&j.vivant)) phases.push('cupidon');
            if(joueurs.some(j=>j.role==='voyante'&&j.vivant)) phases.push('voyante');
            if(joueurs.some(j=>j.role==='renard'&&j.vivant)) phases.push('renard');
            if(joueurs.some(j=>j.role==='seductrice'&&j.vivant)) phases.push('seductrice');
            if(joueurs.some(j=>j.role==='flute'&&j.vivant)) phases.push('flute');
            if(joueurs.some(j=>(j.role==='loup'||j.role==='grandloup')&&j.vivant)) phases.push('loups');
            if(joueurs.some(j=>j.role==='loupblanc'&&j.vivant)&&loupBlancPeutTuer) phases.push('loupblanc');
            if(joueurs.some(j=>j.role==='sorciere'&&j.vivant)) phases.push('sorciere');
        }

        function jouerPhase() {
            if(phaseIndex>=phases.length){afficherJour();return;}
            const phase=phases[phaseIndex];
            if(phase==='cupidon') afficherPhaseCupidon();
            else if(phase==='voyante') afficherPhaseVoyante();
            else if(phase==='renard') afficherPhaseRenard();
            else if(phase==='seductrice') afficherPhaseSeductrice();
            else if(phase==='flute') afficherPhaseFlute();
            else if(phase==='loups') afficherPhaseLoups();
            else if(phase==='loupblanc') afficherPhaseLoupBlanc();
            else if(phase==='petitefille') afficherPhasePetiteFille();
            else if(phase==='sorciere') afficherPhaseSorciere();
        }

        function phaseSuivante(texteRendormir) { phaseIndex++; afficherSommeil(texteRendormir, jouerPhase); }

        function afficherPhaseCupidon() {
            parler("Cupidon se r√©veille... D√©signez les deux amoureux...");
            document.getElementById('phase-emoji').textContent='üíò';
            document.getElementById('phase-titre').textContent='Cupidon se r√©veille';
            document.getElementById('phase-narration').textContent='Choisissez 2 joueurs qui seront amoureux pour toujours.';
            amoureuxTemp=[];
            const action=document.getElementById('phase-action');
            action.innerHTML='<div class="joueurs-grid" id="cupidon-cibles"></div><p style="color:#888;font-size:13px;margin-top:10px" id="cupidon-info">0/2 s√©lectionn√©s</p>';
            const grid=document.getElementById('cupidon-cibles');
            joueurs.forEach((j,idx)=>{
                const btn=document.createElement('button');
                btn.className='joueur-btn'; btn.textContent=j.nom;
                btn.onclick=()=>{
                    if(amoureuxTemp.includes(idx)){amoureuxTemp=amoureuxTemp.filter(i=>i!==idx);btn.classList.remove('selected');}
                    else if(amoureuxTemp.length<2){amoureuxTemp.push(idx);btn.classList.add('selected');}
                    document.getElementById('cupidon-info').textContent=amoureuxTemp.length+'/2 s√©lectionn√©s';
                };
                grid.appendChild(btn);
            });
            document.getElementById('phase-btn').onclick=()=>{
                if(amoureuxTemp.length!==2){alert('Choisis exactement 2 amoureux !');return;}
                amoureux=[...amoureuxTemp];
                joueurs[amoureux[0]].amoureux=true; joueurs[amoureux[1]].amoureux=true;
                phaseSuivante('Cupidon peut se rendormir...');
            };
            showScreen('screen-phase');
        }

        function afficherPhaseVoyante() {
    parler("La Voyante se r√©veille... Elle concentre ses pouvoirs mystiques...");
    document.getElementById('phase-emoji').textContent = 'üëÅÔ∏è';
    document.getElementById('phase-titre').textContent = 'La Voyante se r√©veille';
    document.getElementById('phase-narration').textContent = 'Choisissez un joueur pour voir son r√¥le secret.';
    const action = document.getElementById('phase-action');
    action.innerHTML = '<div class="joueurs-grid" id="voyante-cibles"></div>';
    const grid = document.getElementById('voyante-cibles');
    let voyanteCible = null;
    joueurs.forEach((j, idx) => {
        if(!j.vivant || j.role==='voyante') return;
        const btn = document.createElement('button');
        btn.className = 'joueur-btn'; btn.textContent = j.nom;
        btn.onclick = () => {
            voyanteCible = idx;
            document.querySelectorAll('#voyante-cibles .joueur-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        };
        grid.appendChild(btn);
    });
    document.getElementById('phase-btn').onclick = () => {
        if(voyanteCible === null) { alert('Choisissez un joueur !'); return; }
        // √âcran s√©par√© pour voir le r√¥le
        const j = joueurs[voyanteCible];
        const info = ROLES_INFO[j.role];
        document.getElementById('phase-emoji').textContent = info.emoji;
        document.getElementById('phase-titre').textContent = j.nom + ' est...';
        document.getElementById('phase-narration').textContent = '';
        document.getElementById('phase-action').innerHTML = `
            <div style="font-size:60px;margin-bottom:15px">${info.emoji}</div>
            <div style="font-size:22px;font-weight:bold;color:#a78bfa;margin-bottom:10px">${info.nom}</div>
            <div style="font-size:14px;color:#aaa">${info.equipeLabel}</div>
        `;
        document.getElementById('phase-btn').textContent = 'Fermer üëÅÔ∏è';
        document.getElementById('phase-btn').onclick = () => {
            document.getElementById('phase-btn').textContent = 'Confirmer ‚úÖ';
            phaseSuivante('La Voyante peut se rendormir...');
        };
    };
    showScreen('screen-phase');
}


        function afficherPhaseRenard() {
            parler("Le Renard se r√©veille... Il flaire le danger dans l'obscurit√©...");
            document.getElementById('phase-emoji').textContent='ü¶ä';
            document.getElementById('phase-titre').textContent='Le Renard se r√©veille';
            document.getElementById('phase-narration').textContent='Choisissez un joueur. L\'app r√©v√®lera si lui et ses 2 voisins contiennent un loup.';
            const action=document.getElementById('phase-action');
            action.innerHTML='<div class="joueurs-grid" id="renard-cibles"></div><div id="renard-resultat" style="margin-top:15px;font-size:16px;font-weight:bold"></div>';
            const grid=document.getElementById('renard-cibles');
            let renardCible=-1;
            joueurs.forEach((j,idx)=>{
                if(!j.vivant) return;
                const btn=document.createElement('button');
                btn.className='joueur-btn'; btn.textContent=j.nom;
                btn.onclick=()=>{
                    renardCible=idx;
                    const vivants=joueurs.map((jj,i)=>({...jj,idx:i})).filter(jj=>jj.vivant);
                    const posRenard=vivants.findIndex(jj=>jj.idx===idx);
                    const groupe=[
                        vivants[posRenard],
                        vivants[(posRenard+1)%vivants.length],
                        vivants[(posRenard-1+vivants.length)%vivants.length]
                    ];
                    const yaLoup=groupe.some(jj=>jj&&['loup','grandloup','loupblanc'].includes(jj.role));
                    document.getElementById('renard-resultat').textContent = yaLoup ? 'üê∫ Oui ! Un loup se cache dans ce groupe !' : '‚úÖ Aucun loup dans ce groupe.';
                    document.getElementById('renard-resultat').style.color = yaLoup ? '#ff5555' : '#00e5cc';
                    document.querySelectorAll('#renard-cibles .joueur-btn').forEach(b=>b.classList.remove('selected'));
                    btn.classList.add('selected');
                };
                grid.appendChild(btn);
            });
            document.getElementById('phase-btn').onclick=()=>phaseSuivante('Le Renard peut se rendormir...');
            showScreen('screen-phase');
        }

        function afficherPhaseSeductrice() {
            parler("La S√©ductrice se r√©veille... Elle choisit sa victime pour cette nuit...");
            document.getElementById('phase-emoji').textContent='üíã';
            document.getElementById('phase-titre').textContent='La S√©ductrice se r√©veille';
            document.getElementById('phase-narration').textContent='Choisissez un joueur qui sera muet demain.';
            const action=document.getElementById('phase-action');
            action.innerHTML='<div class="joueurs-grid" id="seductrice-cibles"></div>';
            const grid=document.getElementById('seductrice-cibles');
            joueurs.forEach((j,idx)=>{
                if(!j.vivant||j.role==='seductrice') return;
                const btn=document.createElement('button');
                btn.className='joueur-btn'; btn.textContent=j.nom;
                btn.onclick=()=>{ muetDemain=idx; document.querySelectorAll('#seductrice-cibles .joueur-btn').forEach(b=>b.classList.remove('selected')); btn.classList.add('selected'); };
                grid.appendChild(btn);
            });
            document.getElementById('phase-btn').onclick=()=>phaseSuivante('La S√©ductrice peut se rendormir...');
            showScreen('screen-phase');
        }

        function afficherPhaseFlute() {
            parler("Le Joueur de Fl√ªte se r√©veille... Sa m√©lodie enivrante se r√©pand dans le village...");
            document.getElementById('phase-emoji').textContent='üé∫';
            document.getElementById('phase-titre').textContent='Le Joueur de Fl√ªte';
            document.getElementById('phase-narration').textContent='Choisissez 2 joueurs √† ensorceler avec votre fl√ªte.';
            const action=document.getElementById('phase-action');
            action.innerHTML='<div class="joueurs-grid" id="flute-cibles"></div><p style="color:#888;font-size:13px;margin-top:10px" id="flute-info">0/2 s√©lectionn√©s</p>';
            const grid=document.getElementById('flute-cibles');
            let fluteTemp=[];
            joueurs.forEach((j,idx)=>{
                if(!j.vivant||j.role==='flute') return;
                const btn=document.createElement('button');
                btn.className='joueur-btn'+(j.ensorcele?' selected':'');
                btn.textContent=j.nom+(j.ensorcele?' üé∫':'');
                if(!j.ensorcele) btn.onclick=()=>{
                    if(fluteTemp.includes(idx)){fluteTemp=fluteTemp.filter(i=>i!==idx);btn.classList.remove('selected');}
                    else if(fluteTemp.length<2){fluteTemp.push(idx);btn.classList.add('selected');}
                    document.getElementById('flute-info').textContent=fluteTemp.length+'/2 s√©lectionn√©s';
                };
                grid.appendChild(btn);
            });
            document.getElementById('phase-btn').onclick=()=>{
                fluteTemp.forEach(idx=>{ joueurs[idx].ensorcele=true; });
                const fin=verifierFluteVictoire();
                if(fin){afficherFin('flute');return;}
                phaseSuivante('Le Joueur de Fl√ªte peut se rendormir...');
            };
            showScreen('screen-phase');
        }

        function afficherPhaseLoups() {
    parler("Les Loups Garous se r√©veillent... La petite fille peut ouvrir les yeux... Les loups se reconnaissent entre eux et choisissent leur victime...");
    document.getElementById('phase-emoji').textContent = 'üê∫';
    document.getElementById('phase-titre').textContent = 'Les Loups se r√©veillent';
    const loups = joueurs.filter(j => (j.role==='loup'||j.role==='grandloup') && j.vivant).map(j => j.nom);
    document.getElementById('phase-narration').textContent = 'Loups : ' + loups.join(', ') + '. Choisissez votre victime.';
    const action = document.getElementById('phase-action');
    action.innerHTML = '<div class="joueurs-grid" id="loups-cibles"></div>';
    const grid = document.getElementById('loups-cibles');
    joueurs.forEach((j, idx) => {
        if(!j.vivant || j.role==='loup' || j.role==='grandloup' || j.role==='loupblanc') return;
        const btn = document.createElement('button');
        btn.className = 'joueur-btn'; btn.textContent = j.nom;
        btn.onclick = () => { victimeNuit = idx; document.querySelectorAll('#loups-cibles .joueur-btn').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); };
        grid.appendChild(btn);
    });
    document.getElementById('phase-btn').onclick = () => {
        if(victimeNuit === null) { alert('Choisissez une victime !'); return; }
        phaseSuivante('Les Loups Garous peuvent se rendormir...');
    };
    showScreen('screen-phase');
}


        const loupActuel = loupsVivants[loupVoteIndex];
        document.getElementById('phase-emoji').textContent = 'üê∫';
        document.getElementById('phase-titre').textContent = loupActuel.nom + ', vote !';
        document.getElementById('phase-narration').textContent = 'Qui veux-tu d√©vorer cette nuit ?';
        const action = document.getElementById('phase-action');
        action.innerHTML = '<div class="joueurs-grid" id="loups-cibles"></div>';
        const grid = document.getElementById('loups-cibles');
        joueurs.forEach((j, idx) => {
            if(!j.vivant || j.role==='loup' || j.role==='grandloup' || j.role==='loupblanc') return;
            const btn = document.createElement('button');
            btn.className = 'joueur-btn';
            btn.textContent = j.nom;
            btn.onclick = () => {
                votesLoups[loupActuel.nom] = idx;
                document.querySelectorAll('#loups-cibles .joueur-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
            };
            grid.appendChild(btn);
        });
        document.getElementById('phase-btn').onclick = () => {
            if(votesLoups[loupActuel.nom] === undefined) { alert('Choisis une victime !'); return; }
            loupVoteIndex++;
            if(loupVoteIndex < loupsVivants.length) {
                afficherSommeil('üê∫ Loup suivant...', voterLoupSuivant);
            } else {
                voterLoupSuivant();
            }
        };
        showScreen('screen-phase');
    }

    voterLoupSuivant();
}


        function afficherPhaseLoupBlanc() {
            parler("Le Loup Blanc se r√©veille seul... Il peut √©liminer un autre loup cette nuit...");
            document.getElementById('phase-emoji').textContent='üê∫';
            document.getElementById('phase-titre').textContent='Le Loup Blanc se r√©veille';
            document.getElementById('phase-narration').textContent='Vous pouvez √©liminer un autre loup cette nuit (optionnel).';
            const action=document.getElementById('phase-action');
            action.innerHTML='<div class="joueurs-grid" id="loupblanc-cibles"></div>';
            const grid=document.getElementById('loupblanc-cibles');
            let loupBlancCible=null;
            joueurs.forEach((j,idx)=>{
                if(!j.vivant||j.role!=='loup'&&j.role!=='grandloup') return;
                const btn=document.createElement('button');
                btn.className='joueur-btn'; btn.textContent=j.nom;
                btn.onclick=()=>{ loupBlancCible=idx; document.querySelectorAll('#loupblanc-cibles .joueur-btn').forEach(b=>b.classList.remove('selected')); btn.classList.add('selected'); };
                grid.appendChild(btn);
            });
            document.getElementById('phase-btn').onclick=()=>{
                if(loupBlancCible!==null){ joueurs[loupBlancCible].vivant=false; }
                phaseSuivante('Le Loup Blanc peut se rendormir...');
            };
            showScreen('screen-phase');
        }

        function afficherPhasePetiteFille() {
            parler("La Petite Fille entrouvre les yeux... Elle risque sa vie pour espionner les loups...");
            document.getElementById('phase-emoji').textContent='üëß';
            document.getElementById('phase-titre').textContent='La Petite Fille espionne';
            document.getElementById('phase-narration').textContent='Regardez discr√®tement ! Si les loups vous rep√®rent, vous serez √©limin√©e.';
            document.getElementById('phase-action').innerHTML='<p style="color:#a78bfa;font-size:16px">üê∫ Les loups cette nuit sont :<br><br>'+joueurs.filter(j=>(j.role==='loup'||j.role==='grandloup')&&j.vivant).map(j=>'üê∫ '+j.nom).join('<br>')+'</p>';
            document.getElementById('phase-btn').onclick=()=>phaseSuivante('La Petite Fille peut se rendormir...');
            showScreen('screen-phase');
        }

        function afficherPhaseSorciere() {
            parler("La Sorci√®re se r√©veille... Elle examine ses pr√©cieuses potions...");
            document.getElementById('phase-emoji').textContent='üßô';
            document.getElementById('phase-titre').textContent='La Sorci√®re se r√©veille';
            const victime=victimeNuit!==null?joueurs[victimeNuit].nom:'personne';
            document.getElementById('phase-narration').textContent='Les loups ont attaqu√© : '+victime;
            const action=document.getElementById('phase-action');
            let html='';
            if(sorcierePotionVie&&victimeNuit!==null) html+='<button class="joueur-btn" id="btn-sauver" onclick="sorciereSauver()">üíö Sauver '+victime+'</button><br><br>';
            if(sorcierePotionMort){ html+='<p style="color:#888;font-size:14px;margin-bottom:10px">‚ò†Ô∏è Empoisonner :</p><div class="joueurs-grid" id="sorciere-cibles"></div>'; }
            if(!html) html='<p style="color:#888">Vous n\'avez plus de potions.</p>';
            action.innerHTML=html;
            if(sorcierePotionMort){
                const grid=document.getElementById('sorciere-cibles');
                joueurs.forEach((j,idx)=>{
                    if(!j.vivant) return;
                    const btn=document.createElement('button');
                    btn.className='joueur-btn'; btn.textContent=j.nom;
                    btn.onclick=()=>{ empoisonneParSorciere=idx; sorcierePotionMort=false; document.querySelectorAll('#sorciere-cibles .joueur-btn').forEach(b=>b.classList.remove('selected','empoisonne')); btn.classList.add('empoisonne'); };
                    grid.appendChild(btn);
                });
            }
            document.getElementById('phase-btn').onclick=()=>phaseSuivante('La Sorci√®re peut se rendormir...');
            showScreen('screen-phase');
        }

        function sorciereSauver() {
            sauveParSorciere=true; sorcierePotionVie=false;
            const btn=document.getElementById('btn-sauver');
            btn.textContent='üíö Sauv√© !'; btn.style.borderColor='#00e5cc'; btn.onclick=null;
        }

        function tuerJoueur(idx, raison) {
            const j=joueurs[idx];
            if(!j.vivant) return [];
            j.vivant=false;
            const mortsSup=[];

            // V√©rifier amoureux
            if(j.amoureux){
                const autreIdx=amoureux.find(i=>i!==idx);
                if(autreIdx!==undefined&&joueurs[autreIdx].vivant){ joueurs[autreIdx].vivant=false; mortsSup.push(joueurs[autreIdx].nom+' (mort de chagrin üíî)'); }
            }

            // V√©rifier enfant loup
            if(pereEnfantLoup===idx){ const el=joueurs.find(jj=>jj.role==='enfantloup'&&jj.vivant); if(el){ el.role='loup'; mortsSup.push('‚ö†Ô∏è '+el.nom+' devient Loup Garou !'); } }

            // V√©rifier enfant sauvage
            if(modeleEnfantSauvage===idx){ const es=joueurs.find(jj=>jj.role==='enfantsauvage'&&jj.vivant); if(es){ es.role='loup'; mortsSup.push('‚ö†Ô∏è '+es.nom+' devient Loup Garou !'); } }

            return mortsSup;
        }

        function afficherJour() {
            const morts=[]; const alertes=[];

            // Victime loups
            if(!sauveParSorciere&&victimeNuit!==null){
                const j=joueurs[victimeNuit];
                if(j.role==='ancien'&&ancienPremierAttaque){ ancienPremierAttaque=false; alertes.push('üë¥ L\'Ancien a surv√©cu √† l\'attaque des loups !'); }
                else { const sup=tuerJoueur(victimeNuit,'loups'); morts.push(j.nom); alertes.push(...sup); }
            }

            // Empoisonn√© sorci√®re
            if(empoisonneParSorciere!==null){ const sup=tuerJoueur(empoisonneParSorciere,'sorciere'); morts.push(joueurs[empoisonneParSorciere].nom+' (empoisonn√© üßô)'); alertes.push(...sup); empoisonneParSorciere=null; }
            sauveParSorciere=false;

            const mortBox=document.getElementById('mort-annonce-box');
            if(morts.length===0&&alertes.length===0){
                mortBox.innerHTML='<div class="mort-annonce" style="border-color:#00e5cc;background-color:#001a1a">üåü Cette nuit, personne n\'est mort !</div>';
                parler('Le jour se l√®ve. Cette nuit, personne n\'est mort. Le village est soulag√©... mais les loups r√¥dent encore.');
            } else {
                let html='<div class="mort-annonce">';
                if(morts.length>0) html+='üíÄ '+morts.join(' et ')+' ont √©t√© retrouv√©s morts...<br>';
                alertes.forEach(a=>{ html+='<br>'+a; });
                html+='</div>';
                mortBox.innerHTML=html;
                parler('Le jour se l√®ve. '+morts.join(' et ')+(morts.length>0?' ont √©t√© retrouv√©s morts.':''));
            }

            // Ours de Thiercelieux
            const ours=joueurs.find(j=>j.role==='ours'&&j.vivant);
            const oursBox=document.getElementById('ours-annonce');
            if(ours){
                const vivants=joueurs.filter(j=>j.vivant);
                const idxOurs=vivants.findIndex(j=>j.role==='ours');
                const voisins=[vivants[(idxOurs-1+vivants.length)%vivants.length],vivants[(idxOurs+1)%vivants.length]];
                const loupVoisin=voisins.some(j=>j&&['loup','grandloup','loupblanc'].includes(j.role));
                oursBox.style.display=loupVoisin?'block':'none';
                if(loupVoisin) parler('Grrr ! L\'Ours grogne ! Un loup est assis √† c√¥t√© de lui !');
            } else { oursBox.style.display='none'; }

            const fin=verifierFinDePartie();
            if(fin){setTimeout(()=>afficherFin(fin),2000);return;}

            // V√©rifier chasseur mort
            const chasseurMort=morts.find(nom=>joueurs.find(j=>j.nom===nom&&j.role==='chasseur'));
            if(chasseurMort){ setTimeout(()=>afficherChasseur(joueurs.findIndex(j=>j.nom===chasseurMort)),500); return; }

            showScreen('screen-jour');
            numNuit++;
        }

        function afficherChasseur(idx) {
            document.getElementById('chasseur-nom').textContent='üèπ '+joueurs[idx].nom+' est mort !';
            const grid=document.getElementById('chasseur-cibles');
            grid.innerHTML='';
            chasseurCible=null;
            joueurs.forEach((j,jIdx)=>{
                if(!j.vivant||jIdx===idx) return;
                const btn=document.createElement('button');
                btn.className='joueur-btn'; btn.textContent=j.nom;
                btn.onclick=()=>{ chasseurCible=jIdx; document.querySelectorAll('#chasseur-cibles .joueur-btn').forEach(b=>b.classList.remove('selected')); btn.classList.add('selected'); };
                grid.appendChild(btn);
            });
            showScreen('screen-chasseur');
        }

        function confirmerTirChasseur() {
            if(chasseurCible===null){alert('Choisissez une cible !');return;}
            const cible=joueurs[chasseurCible];
            tuerJoueur(chasseurCible,'chasseur');
            alert('üíÄ '+cible.nom+' a √©t√© tu√© par le Chasseur !\nIl √©tait : '+ROLES_INFO[cible.role].emoji+' '+ROLES_INFO[cible.role].nom);
            const fin=verifierFinDePartie();
            if(fin){afficherFin(fin);return;}
            showScreen('screen-jour');
            numNuit++;
        }

        function commencerVote() {
            voteSelectionne=-1;
            const liste=document.getElementById('vote-liste');
            liste.innerHTML='';
            document.getElementById('vote-subtitle').textContent=muetAujourdhui!==null?'‚ö†Ô∏è '+joueurs[muetAujourdhui].nom+' ne peut pas voter !':'Qui voulez-vous √©liminer ?';
            joueurs.forEach((j,idx)=>{
                if(!j.vivant) return;
                const div=document.createElement('div');
                div.className='vote-joueur';
                div.innerHTML='<span>'+j.nom+(muetAujourdhui===idx?' ü§ê':'')+'</span><span style="color:#888;font-size:13px">'+ROLES_INFO[j.role].emoji+'</span>';
                div.onclick=()=>{ voteSelectionne=idx; document.querySelectorAll('.vote-joueur').forEach(d=>d.classList.remove('selected')); div.classList.add('selected'); };
                liste.appendChild(div);
            });
            showScreen('screen-vote');
        }

        function confirmerVote() {
            if(voteSelectionne===-1){alert('Choisissez quelqu\'un !');return;}
            const elimine=joueurs[voteSelectionne];

            // Ancien √©limin√© par vote ‚Äî tous les villageois sp√©ciaux perdent leurs pouvoirs
            if(elimine.role==='ancien'){
                parler(elimine.nom+' √©tait l\'Ancien ! Les villageois ont perdu leurs pouvoirs sp√©ciaux !');
                alert('üë¥ '+elimine.nom+' √©tait l\'Ancien !\n‚ö†Ô∏è Tous les villageois sp√©ciaux perdent leurs pouvoirs !');
                ['voyante','sorciere','chasseur','renard','seductrice','ours'].forEach(role=>{ joueurs.forEach(j=>{ if(j.role===role) j.role='villageois'; }); });
            }

            const sup=tuerJoueur(voteSelectionne,'vote');
            parler(elimine.nom+' a √©t√© √©limin√©. Il √©tait '+ROLES_INFO[elimine.role].nom);
            let msg='üíÄ '+elimine.nom+' a √©t√© √©limin√© !\nIl √©tait : '+ROLES_INFO[elimine.role].emoji+' '+ROLES_INFO[elimine.role].nom;
            if(sup.length>0) msg+='\n\n'+sup.join('\n');
            alert(msg);

            const fin=verifierFinDePartie();
            if(fin){afficherFin(fin);return;}

            // Chasseur √©limin√© par vote
            if(elimine.role==='chasseur'){ afficherChasseur(voteSelectionne); return; }

            afficherNuitIntro();
        }

        function passerVote() {
            const fin=verifierFinDePartie();
            if(fin){afficherFin(fin);return;}
            afficherNuitIntro();
        }

        function verifierFluteVictoire() {
            return joueurs.filter(j=>j.vivant&&j.role!=='flute').every(j=>j.ensorcele);
        }

        function verifierFinDePartie() {
            const loupsVivants=joueurs.filter(j=>(j.role==='loup'||j.role==='grandloup')&&j.vivant).length;
            const loupBlancVivant=joueurs.find(j=>j.role==='loupblanc'&&j.vivant);
            const villageoirsVivants=joueurs.filter(j=>j.role!=='loup'&&j.role!=='grandloup'&&j.role!=='loupblanc'&&j.vivant).length;
            const totalVivants=joueurs.filter(j=>j.vivant).length;

            if(loupBlancVivant&&totalVivants===1) return 'loupblanc';
            if(verifierFluteVictoire()) return 'flute';

            // Amoureux loup+villageois = victoire couple
            if(amoureux.length===2){
                const a1=joueurs[amoureux[0]], a2=joueurs[amoureux[1]];
                if(a1.vivant&&a2.vivant&&totalVivants===2){ const roles=[a1.role,a2.role]; if(roles.includes('loup')&&!roles.every(r=>r==='loup')) return 'amoureux'; }
            }

            if(loupsVivants===0) return 'village';
            if(loupsVivants>=villageoirsVivants) return 'loups';
            return null;
        }

        function afficherFin(gagnant) {
            const configs={
                village:   {emoji:'üßë‚Äçüåæ', titre:'Le Village a gagn√© !',      desc:'Tous les loups ont √©t√© √©limin√©s. Le village peut enfin dormir en paix !', parole:'Le village a gagn√© ! Tous les loups ont √©t√© √©limin√©s.'},
                loups:     {emoji:'üê∫', titre:'Les Loups ont gagn√© !',       desc:'Les loups ont pris le contr√¥le du village. La nuit r√®gne pour toujours...', parole:'Les loups garous ont gagn√© ! Ils ont pris le contr√¥le du village.'},
                loupblanc: {emoji:'üê∫', titre:'Le Loup Blanc a gagn√© !',     desc:'Le Loup Blanc a √©limin√© tout le monde et r√®gne seul sur le village !', parole:'Le Loup Blanc a gagn√© tout seul !'},
                flute:     {emoji:'üé∫', titre:'Le Joueur de Fl√ªte a gagn√© !',desc:'Tous les survivants sont sous l\'emprise de sa musique ensorcelante !', parole:'Le Joueur de Fl√ªte a gagn√© ! Tout le monde est ensorcel√©.'},
                amoureux:  {emoji:'üíï', titre:'Les Amoureux ont gagn√© !',    desc:'Leur amour a triomph√© de tout ‚Äî loups et villageois confondus !', parole:'Les amoureux ont gagn√© ! Leur amour a tout surmont√©.'},
            };
            const cfg=configs[gagnant]||configs.village;
            document.getElementById('fin-emoji').textContent=cfg.emoji;
            document.getElementById('fin-titre').textContent=cfg.titre;
            document.getElementById('fin-desc').textContent=cfg.desc;
            parler(cfg.parole);
            const rolesDiv=document.getElementById('fin-roles');
            rolesDiv.innerHTML='';
            joueurs.forEach(j=>{
                const info=ROLES_INFO[j.role];
                rolesDiv.innerHTML+=`<div class="score-final-box"><span>${j.vivant?'‚úÖ':'üíÄ'} ${j.nom}</span><span>${info.emoji} ${info.nom}</span></div>`;
            });
            showScreen('screen-fin');
        }

document.addEventListener('DOMContentLoaded', suggererRoles);
    </script>
</body>
</html>
